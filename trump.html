<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
	html, body {
		height: 100%;
		margin: 0;
	}

	img {
		position: absolute;
	}
	
	#wrapper {
		min-height: 100%; 
	}
	.hidden { display: none; }
</style>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="alertify.min.js"></script>
<link rel="stylesheet" href="alertify.core.css" />
<link rel="stylesheet" href="alertify.default.css" />
</head>


<body>
<div id="wrapper" width: 100%; height: 100%; ></div>
<script type="text/javascript">
	var trumpLocationX;
	var trumpLocationY;
	var isDonaldShowing = false;
	//Size ratio width = 193, height = 142 => W/H = 1.36
	var iWidth = 150, iHeight = 155;

	$( document ).ready(function() {
		chooseLocation();
		PositionImage();
		$("#trumpImage").css('opacity', '0');
		$("#trumpImage").on("click", function(e){
			isDonaldShowing = true;
			$("#trumpImage").animate({ opacity:1}, 1000);
			alertify.set({ labels: {
				ok     : "Find Him Again",
				cancel : "Done with this guy!"
			} });
			setTimeout(showDialog, 1000);

		});
	});
	function showDialog(){
		// confirm dialog
		alertify.confirm("You found the Donald", function (e) {
			if (e) {
				// user clicked "ok"
				var likeChina = new Audio('Sounds/iLikeChina.mp3');
				likeChina.volume = 1;
				likeChina.play();
				setTimeout(reloadPage, 1500);	
				isDonaldShowing = false;
			} else {
				// user clicked "cancel"
				var china = new Audio('Sounds/IBeatChinaAllTheTime.mp3');
				china.volume = 1;
				china.play();
				setTimeout(redirect, 2000);
			}
		});
	}
	function reloadPage(){
		location.reload()
	}
	function redirect(){
		window.location.replace("http://imgur.com/")
	}
	$("#wrapper").on("click",function(e){
		if (e.target.id == "trumpImage" || $(e.target).parents("#trumpImage").size()) { 
			var kaChing = new Audio('Sounds/kaChing.mp3');
			kaChing.volume = 1;
			kaChing.play();
        } else { 
			if(!isDonaldShowing){
				var beatChina = new Audio('Sounds/China.mp3');
				beatChina.volume = getVolume(event);
				beatChina.play();
			}
        }
	});
	
	function PositionImage(){
		$("#wrapper").each(function(e){
			var screen = document.getElementById("wrapper");
			var top = trumpLocationY, left = trumpLocationX;
			console.log("screenX: " + screen.clientWidth + "  screenY: " + screen.clientHeight);
			$('#trumpImage').remove();
			var x = Math.round(left - iWidth/2);
			var y = Math.round(top - iHeight/2);
			console.log(x + " " + y);
			$(this).append("<img src='trump.png' id='trumpImage' style='width:"+iWidth+"px; height: "+iHeight+"px; top:"+y+"px;left:"+x+"px;'/>");
		});
	}
	function getVolume(event){
		var screen = document.getElementById("wrapper");
		var clickCoords = getCoords(event);
		var longestDistance = getLongestPossibleDistance(screen.clientWidth, screen.clientHeight, trumpLocationX, trumpLocationY);
		var distance = Math.sqrt(Math.pow(trumpLocationX - clickCoords[0],2) + Math.pow(trumpLocationY - clickCoords[1],2));
		var volume = (1 - Math.pow((distance / longestDistance), 1));
		console.log("Volume: " + volume);
		return volume;
	}
	//Theoretically one of the 4 corners has to be the farthest from any point on the screen
	function getLongestPossibleDistance(screenX, screenY, targetX, targetY){
		var bottomLeft = Math.sqrt(Math.pow(targetX - 0,2) + Math.pow(targetY - screenY,2));
		var topLeft = Math.sqrt(Math.pow(targetX - 0,2) + Math.pow(targetY - 0,2));
		var bottomRight = Math.sqrt(Math.pow(targetX - screenX,2) + Math.pow(targetY - screenY,2));
		var topRight = Math.sqrt(Math.pow(targetX - 0,2) + Math.pow(targetY - screenY,2));
		return Math.max(Math.max(Math.max(bottomLeft, bottomRight), topLeft), topRight);
	}
	function getCoords(event) {
		var x = event.clientX;
		var y = event.clientY;
		return [x,y];
	}
	function chooseLocation(){
		var screen = document.getElementById("wrapper");
		trumpLocationX = getRandomInt(0, screen.clientWidth);
		trumpLocationY = getRandomInt(0, screen.clientHeight);
		
	}
	function getRandomInt(min, max) {
		var budget = 0.1;
		min = max * budget;
		max = max * (1-budget);
		return Math.floor(Math.random() * (max - min + 1)) + min;
	}
</script>
</body>
</html>